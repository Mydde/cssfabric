// load scss config file
@use '../../_utils';
@use '../cssfabric-config';
@use 'grid-vars';

$grid-config: grid-vars.$grid-config;
$cssfabric-config: cssfabric-config.$cssfabric-config;

$sep: map-get($cssfabric-config, sep);
// read variables
$grid-code: map-get($grid-config, moduleNameShort);
$grid-h: map-get($grid-config, horCode);
$grid-v: map-get($grid-config, vertCode);

$cssProps: map-get($grid-config, cssProps);
$cssItemsProps: map-get($grid-config, cssItemsProps);

$gridFullWidth: map-get($grid-config, gridFullWidth);

$grow-shrink-steps: map-get($grid-config, grow-shrink-steps);

$grid-code-sep: #{$grid-code}#{$sep};

@mixin makeGrid($mqKey) {
  $prefix: if($mqKey, #{$grid-code}-#{$mqKey}, #{$grid-code});
  $h_prop: #{$prefix}#{$sep}#{$grid-h};
  $v_prop: #{$prefix}#{$sep}#{$grid-v};

  %flex {
    display: grid; 
  }

  .#{$h_prop} {
    display: grid;
    flex-direction: row;

    & > .#{$grid-code-sep}#{$gridFullWidth} {
      flex: 1 1 0;
    }


  }

  .#{$v_prop} {
    display: grid;
    flex-direction: column;

    & > .#{$grid-code-sep}#{$gridFullWidth} {
      flex: 1 1 0;
      max-height: 100%;
    }

    &.align-middle, &.#{$grid-code-sep}align-middle {
      justify-content: center;
    }

  }

  .#{$h_prop},
  .#{$v_prop} {

    & > *:not(.#{$grid-code-sep}#{$gridFullWidth}) {
      flex: 0 0 auto;
    }

    &.#{$grid-code-sep}inline {
      display: inline-grid;
    }

  }

  /** raw css properties distribution */
  .#{$h_prop},
  .#{$v_prop} {
    // wrap rules
    &.#{$grid-code} {
      @each $fabricRule, $value in map-get($cssProps, flexWrap) {
        @include utils.fabricAttributes('&'+$sep, $fabricRule, 'flex-wrap', $value);
      }
    }

    // align-self rules for children */
    & .self {
      @each $fabricRule, $value in map-get($cssItemsProps, self) {
        @include utils.fabricAttributes('&-', $fabricRule, 'align-self', $value);
      }
    }
  }


}
